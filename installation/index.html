<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Installation - SwordPHISH</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Installation";
        var mkdocs_page_input_path = "installation.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> SwordPHISH
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Swordphish</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../campaigns/">Campaigns</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Installation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installing-dependencies">Installing Dependencies</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configuring-and-creating-database">Configuring and Creating database</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#swordphish-configuration">Swordphish Configuration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setting-up-supervisor">Setting up supervisor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#nginx-configuration">Nginx Configuration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#swordphish-last-setup">Swordphish last setup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#antispam">Antispam?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#about-phishing-domains">About phishing domains</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../special-features/">Special Features</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../targets/">Targets</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../templates/">Templates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../users-management/">Users management</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">SwordPHISH</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Installation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="installation">Installation</h1>
<h2 id="requirements">Requirements</h2>
<p>Swordphish requires a few important things before starting installation
process:</p>
<ul>
<li><strong>A server</strong>: we recommend to adjust the choice of the server
  depending on the campaign sizes you want to do (100k targets is a
  BIG campaign)</li>
<li><strong>At least two domains names</strong>: one to join Swordphish web page and
  at least one phishing domain (to send mails and host phishing pages)</li>
<li><strong>A mail server</strong>: we won't cover the mail server installation
  here, but keep in mind that a well configured mail server can
  accelerate drastically phishing mails diffusion</li>
</ul>
<p>The domain name used to join Swordphish interface must have at least an <code>A</code>
entry in the DNS zone pointing to the server's IP.</p>
<p>The domain(s) used to send mail and host phishing pages must have at
least two entry in the DNS Zone. An <code>A</code> entry pointing to the server and a
subdomain wildcard entry pointing to the same server IP (it allows to
use subdomains in phishing pages).</p>
<p>The following installation process has been tested on Ubuntu Server
(16.04) but you can use any Linux (or Unix?) distro you like, but we
won't provide any support for that.</p>
<h2 id="installing-dependencies">Installing Dependencies</h2>
<p>Required packages:</p>
<div class="highlight"><pre><span></span><code>apt<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>libpq-dev<span class="w"> </span>nginx<span class="w"> </span>git<span class="w"> </span>supervisor<span class="w"> </span>redis-server
apt<span class="w"> </span>install<span class="w"> </span>python3-dev<span class="w"> </span>python3-pip<span class="w"> </span>postgresql<span class="w"> </span>postgresql-contrib
apt<span class="w"> </span>install<span class="w"> </span>virtualenv<span class="w"> </span>virtualenvwrapper
</code></pre></div>
<p>Create a dedicated user for security purpose:</p>
<div class="highlight"><pre><span></span><code>adduser<span class="w"> </span>swordphish<span class="w"> </span>--disabled-password
</code></pre></div>
<p>Add the following line in the user's \~/.profile to enable
virtualenvwrapper:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">WORKON_HOME</span><span class="o">=</span>~/.virtualenvs
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$WORKON_HOME</span>
<span class="nb">source</span><span class="w"> </span><span class="k">$(</span>which<span class="w"> </span>virtualenvwrapper.sh<span class="k">)</span>
</code></pre></div>
<p>Switch to newly created user and git-clone Swordphish repository:</p>
<div class="highlight"><pre><span></span><code>su<span class="w"> </span>-<span class="w"> </span>swordphish
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/societe-generale/swordphish-awareness.git<span class="w"> </span>swordphish
</code></pre></div>
<p>Ensure that virtualenvwrapper has been loaded in user's environment and
create the virtualenv:</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>~/.profile
mkvirtualenv<span class="w"> </span>-p<span class="w"> </span>python3<span class="w"> </span>-a<span class="w"> </span>/home/swordphish/swordphish/<span class="w"> </span>swordphish
</code></pre></div>
<p>You can choose not to create the virtualenv, but <strong>we highly recommend
it</strong> to prevent any side effect with another app installed on the same
server for example.</p>
<p>Install all the python dependencies:</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</code></pre></div>
<h2 id="configuring-and-creating-database">Configuring and Creating database</h2>
<p>Switch to postgresql user:</p>
<div class="highlight"><pre><span></span><code>su<span class="w"> </span>-<span class="w"> </span>postgres
createuser<span class="w"> </span>-P<span class="w"> </span>swordphish
createdb<span class="w"> </span>--owner<span class="w"> </span>swordphish<span class="w"> </span>swordphish
</code></pre></div>
<p>Don't forget the password you'll need it later!</p>
<p>Depending on the size of the campaigns you want to do, consider tuning
Postgresql performance depending of the machine you run swordphish on.</p>
<p>Here is a list of parameter you should consider adapt:</p>
<ul>
<li><strong>shared_buffers</strong>: memory used to cache data, consider setting this
  to 1/4 of the total RAM</li>
<li><strong>work_mem</strong>: 50MB is a nice value if you have more than 16go of RAM</li>
<li><strong>maintenance_work_mem</strong>: the maximum memory postgres can use for
  maintenance (index creation etc.)</li>
<li><strong>wal_buffers</strong>: 1/32 of the size of shared_buffers, with an upper
  limit of 16MB</li>
<li><strong>effective_cache_size</strong>: 1/2 of total memory would be a normal
  conservative setting</li>
</ul>
<h2 id="swordphish-configuration">Swordphish Configuration</h2>
<p>Now let's adapt Swordphish to your environment. Go to the path where
you've installed the code and copy the settings.py file to a new one:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/home/swordphish/swordphish/
cp<span class="w"> </span>Swordphish/settings.py<span class="w"> </span>Swordphish/settings_prod.py
</code></pre></div>
<p>Then generate a new secret-key:</p>
<div class="highlight"><pre><span></span><code>workon<span class="w"> </span>swordphish
./manage.py<span class="w"> </span>generate_secret_key
</code></pre></div>
<p>Then open the newly created settings_prod.py with your favorite editor.
Here is the value you must change:</p>
<ul>
<li><strong>ADMINS</strong>: fill the array with the different admins' mails
  (they'll receive stacktraces and potential errors)</li>
<li><strong>DEBUG</strong>: set this to False once you have tested everything</li>
<li><strong>DATABASES</strong>: set the credentials of the postgres account you
  created before</li>
<li><strong>SWORDPHISH_URL</strong>: set this to the URL you'll use to reach
  Swordphish interface</li>
<li><strong>USER_ACCOUNT_CREATION_MAIL_SENDER</strong>: the mail address which will
  be used to send swordphish accounts creation mails</li>
<li><strong>USER_ACCOUNT_CREATION_MAIL_CONTACT</strong>: the mail address used as
  reply to in the swordphish accounts creation mails</li>
<li><strong>SERVER_EMAIL</strong>: mail address which will be used to send different
  mails like stacktraces</li>
<li><strong>EMAIL_HOST</strong>: mail server address</li>
<li><strong>EMAIL_PORT</strong>: mail server port</li>
<li><strong>EMAIL_HOST_USER</strong>: optional</li>
<li><strong>EMAIL_HOST_PASSWORD</strong>: optional</li>
<li><strong>HOSTING_DOMAIN</strong>: the domain which will be used to reach
  swordphish interface (used to prevent targets from reaching the
  interface using phishing domains)</li>
</ul>
<p>Let's start using this freshly created config file:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DJANGO_SETTINGS_MODULE</span><span class="o">=</span><span class="s1">&#39;Swordphish.settings_prod&#39;</span>
</code></pre></div>
<p>Now let's create DB structure:</p>
<div class="highlight"><pre><span></span><code>./manage.py<span class="w"> </span>migrate
</code></pre></div>
<p>And create super admin user (use mail address as login):</p>
<div class="highlight"><pre><span></span><code>./manage.py<span class="w"> </span>createsuperuser
</code></pre></div>
<p>Finally collect different static files within static dir:</p>
<div class="highlight"><pre><span></span><code>./manage.py<span class="w"> </span>collectstatic
</code></pre></div>
<h2 id="setting-up-supervisor">Setting up supervisor</h2>
<p>Now everything is configured let's create supervisor configuration
files. This will start the app and the celery tasks. We chose supervisor
because it's system agnostic and work whether you use SystemD, Upstart
or whatever...</p>
<p>Three configuration files are mandatory:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/etc/supervisor/conf.d/
</code></pre></div>
<p>Use your favorite editor to create the three following files (adjust the
different values depending on your system):</p>
<ul>
<li><strong>swordphish_celery_beat.conf</strong>: to start the beat scheduler:</li>
</ul>
<div class="highlight"><pre><span></span><code>      [program:swordphish_celery_beat]
      environment=DJANGO_SETTINGS_MODULE=&#39;Swordphish.settings_prod&#39;
      directory=/home/swordphish/swordphish/
      command=/home/swordphish/.virtualenvs/swordphish/bin/celery -A Swordphish beat -l info
      user=swordphish
      autostart=true
      autorestart=true
      stdout_logfile=/var/log/supervisor/swordphish_celery_beat.log
      redirect_stderr=true
</code></pre></div>
<ul>
<li><strong>swordphish_celery_worker.conf</strong>: to start the workers:</li>
</ul>
<div class="highlight"><pre><span></span><code>      [program:swordphish_celery_worker]
      environment=DJANGO_SETTINGS_MODULE=&#39;Swordphish.settings_prod&#39;
      directory=/home/swordphish/swordphish/
      command=/home/swordphish/.virtualenvs/swordphish/bin/celery -A Swordphish worker -l info
      user=swordphish
      autostart=true
      autorestart=true
      stdout_logfile=/var/log/supervisor/swordphish_celery_worker.log
      redirect_stderr=true
</code></pre></div>
<ul>
<li><strong>swordphish.conf</strong>: to start the app server:</li>
</ul>
<div class="highlight"><pre><span></span><code>      [program:swordphish]
      environment=DJANGO_SETTINGS_MODULE=&#39;Swordphish.settings_prod&#39;
      directory=/home/swordphish/swordphish/
      command=/home/swordphish/.virtualenvs/swordphish/bin/uwsgi --ini /home/swordphish/swordphish/uwsgi/uwsgi.ini
      user=swordphish
      autostart=true
      autorestart=true
      stdout_logfile=/var/log/supervisor/swordphish.log
      redirect_stderr=true
</code></pre></div>
<p>And start supervisor services:</p>
<div class="highlight"><pre><span></span><code>supervisorctl<span class="w"> </span>reread
supervisorctl<span class="w"> </span>reload
</code></pre></div>
<p>We recommend checking that everything run correctly using ps command and
netstat.</p>
<h2 id="nginx-configuration">Nginx Configuration</h2>
<p>Now that the app server is running, we need to configure Nginx http
server to access swordphish interface and phishing pages.</p>
<p>Two sites config are mandatory for swordphish. One for Swordphish
interface and one for the phishing domains.</p>
<p>We recommend to host Swordphish using a TLS connection, here is an
example of nginx configuration file:</p>
<div class="highlight"><pre><span></span><code>    #UPSTREAM
    upstream swordphish {
        # Considering that the uwsgi service is running behind TCP 8000 port
        server 127.0.0.1:8000;
    }

    # HTTP SECTION
    # All requests redirected to HTTPS SECTION
    server {
            listen   80;
            server_name FIXME_HOSTNAME;
            rewrite     ^   https://$server_name$request_uri? permanent;


            location /static/ {
               alias   /home/swordphish/swordphish/static/; #Adjust depending on your config
            }
    }


    # HTTPS SECTION
    server {
      listen 443;
      server_name FIXME_HOSTNAME;

       location /static/ {
          alias   /home/swordphish/swordphish/static/; #Adjust depending on your config
      }

      ssl on;
      ssl_certificate /etc/ssl/certs/FIXME_CERTIFICATE;
      ssl_certificate_key /etc/ssl/private/FIXME_PRIVATE_KEY;

      ssl_session_cache shared:SSL:50m;
      ssl_session_timeout 5m;

      ssl_protocols TLSv1.1 TLSv1.2;
      #ssl_ciphers &quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;;
      ssl_ciphers &quot;EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH EDH+aRSA!RC4!aNULL!eNULL!LOW!3DES!MD5!EXP!PSK!SRP!DSS&quot;;
      #ssl_ciphers DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:EDH-RSA-DES-CBC3-SHA:AES256-SHA:DES-CBC3-SHA:AES128-SHA;#:RC4-SHA:RC4-MD5;
      ssl_prefer_server_ciphers on;
      ssl_dhparam /etc/ssl/certs/FIXME_DH_PARAMS;

      access_log /var/log/nginx/swordphish_access.log;
      error_log /var/log/nginx/swordphish_error.log warn;

      add_header Strict-Transport-Security max-age=63072000;
      add_header X-Frame-Options DENY;
      add_header X-Content-Type-Options nosniff;

          error_page    403 /errors/error.html;

      # Allows big file upload
      client_max_body_size 0;

      proxy_connect_timeout       600;
      proxy_send_timeout          600;
      proxy_read_timeout          600;
      send_timeout                600;

      # FIR
      location / {
        proxy_pass http://swordphish;
        proxy_set_header Host $http_host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      }
    }
</code></pre></div>
<p>Phishing domains are hosted with classic HTTP service, and a \"server\"
section is required for every phishing domain you want to use.</p>
<p>Here is a nginx config file example:</p>
<div class="highlight"><pre><span></span><code>    #UPSTREAM
      upstream swordphish {
          # Considering that the uwsgi service is running behind TCP 8000 port
          server 127.0.0.1:8000;
      }

    server {
           listen 80;
           server_name .fixme-example.net;

           error_page    403 /errors/error.html;

           # Allows big file upload
           client_max_body_size 0;

           # Swordphish
           location / {
                  proxy_pass http://swordphish;
                  proxy_set_header Host  fixme-example.net;
           }

    server {
           listen 80;
           server_name .fixme-example2.net;

           error_page    403 /errors/error.html;

           # Allows big file upload
           client_max_body_size 0;

           # Swordphish
           location / {
                  proxy_pass http://swordphish;
                  proxy_set_header Host  fixme-example2.net;
           }
</code></pre></div>
<p>Create the two files here:</p>
<div class="highlight"><pre><span></span><code>touch<span class="w"> </span>/etc/nginx/sites-available/swordphish.conf
touch<span class="w"> </span>/etc/nginx/sites-available/swordphish_phishing_domains.conf
</code></pre></div>
<p>And link them to the sites-enabled:</p>
<div class="highlight"><pre><span></span><code>ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/swordphish.conf<span class="w"> </span>/etc/nginx/sites-enabled/swordphish.conf
ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/swordphish_phishing_domains.conf<span class="w"> </span>/etc/nginx/sites-enabled/swordphish_phishing_domains.conf
</code></pre></div>
<p>Then restart nginx:</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx<span class="w"> </span><span class="c1"># (considering you&#39;re using systemd)</span>
</code></pre></div>
<h2 id="swordphish-last-setup">Swordphish last setup</h2>
<p>Now you should be able to reach Swordphish interface. Start your
favorite browser and browse to the interface. You should be able to see
something like this.</p>
<p><img alt="image" src="../images/01-swordphish-login.png" /></p>
<p>Then log into Swordphish using the superuser account you create before.
Then go to the django admin interface.</p>
<p><img alt="image" src="../images/02-django-admin.png" /></p>
<p>Then go to the phishmail domains management interface.</p>
<p><img alt="image" src="../images/03-phishmail-domains.png" /></p>
<p>Click on the \"add\" button, fill the form and save.</p>
<p><img alt="image" src="../images/04-add-phishmail-domain.png" /></p>
<p><img alt="image" src="../images/05-phishmail-domain-form.png" /></p>
<p>Repeat this operation to add all your phishmail domains.</p>
<p><strong>Congratulation, you're now ready to phish</strong></p>
<h2 id="antispam">Antispam?</h2>
<p>Sending a lot of emails will maybe trigger your antispam / anti-phishing
solution. Don't forget to set up the SPF entry of your phishing domains
and if necessary whitelist the mail server on your infrastructure.</p>
<h2 id="about-phishing-domains">About phishing domains</h2>
<p>We highly recommend to create and follow an abuse mailbox on your
phishing domains.</p>
<p>Your phishing mail will probably be forwarded outside your
organization, and it can have repercussion.</p>
<p>Keeping an eye on abuse mailboxes will allow you to manage these cases
most of the time.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../campaigns/" class="btn btn-neutral float-left" title="Campaigns"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../special-features/" class="btn btn-neutral float-right" title="Special Features">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../campaigns/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../special-features/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
